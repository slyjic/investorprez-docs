<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRAPESJS RENDERING
ARCHITECTURE - InvestorPrez Documentation</title>
    <meta name="description" content="InvestorPrez documentation">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #fff;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .nav-bar {
            background: #667eea;
            color: white;
            padding: 1rem;
            margin: -2rem -2rem 2rem -2rem;
            border-radius: 0;
        }
        
        .nav-bar a {
            color: white;
            text-decoration: none;
            margin-right: 1rem;
        }
        
        .nav-bar a:hover {
            text-decoration: underline;
        }
        
        h1, h2, h3, h4, h5, h6 {
            color: #2d3748;
            margin: 1.5rem 0 1rem 0;
        }
        
        h1 {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }
        
        p {
            margin: 1rem 0;
        }
        
        a {
            color: #667eea;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        pre {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        code {
            background: #f7fafc;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
        }
        
        pre code {
            background: none;
            padding: 0;
        }
        
        blockquote {
            border-left: 4px solid #667eea;
            padding-left: 1rem;
            margin: 1rem 0;
            font-style: italic;
            color: #666;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1rem 0;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 0.5rem;
            text-align: left;
        }
        
        th {
            background: #f7fafc;
            font-weight: 600;
        }
        
        ul, ol {
            margin: 1rem 0 1rem 2rem;
        }
        
        .footer {
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="nav-bar">
        <a href="../../../">üè† Home</a>
        <a href="../../">üìö Documentation</a>
        <a href="https://app.investorprez.com">üöÄ InvestorPrez App</a>
    </div>
    
    <h1 id="grapesjs-rendering-architecture-documentation">GrapesJS
    Rendering Architecture Documentation</h1>
    <p><strong>Last Updated</strong>: August 5, 2025<br />
    <strong>Version</strong>: v1.10.40<br />
    <strong>Status</strong>: Production Ready</p>
    <h2 id="table-of-contents">üìã Table of Contents</h2>
    <ol type="1">
    <li><a href="#overview">Overview</a></li>
    <li><a href="#architecture-decision">Architecture Decision</a></li>
    <li><a href="#component-rendering-pipeline">Component Rendering
    Pipeline</a></li>
    <li><a href="#sdk-component-support">SDK Component Support</a></li>
    <li><a href="#testing-checklist">Testing Checklist</a></li>
    <li><a href="#troubleshooting-guide">Troubleshooting Guide</a></li>
    </ol>
    <h2 id="overview">üéØ Overview</h2>
    <p>InvestorPrez uses a <strong>hybrid rendering approach</strong>
    that combines:</p>
    <ul>
    <li><strong>GrapesJS Editor</strong>: For creating and editing
    presentations</li>
    <li><strong>Custom Rendering Pipeline</strong>: For publishing
    static HTML presentations</li>
    <li><strong>Data Isolation</strong>: Each presentation‚Äôs data is
    completely isolated</li>
    </ul>
    <h3 id="why-custom-rendering">Why Custom Rendering?</h3>
    <p>We use custom rendering instead of GrapesJS native export for
    several critical reasons:</p>
    <ol type="1">
    <li><strong>Data Isolation</strong>: Prevents cross-presentation
    data contamination</li>
    <li><strong>Security</strong>: Server-side rendering prevents
    client-side tampering</li>
    <li><strong>Performance</strong>: Optimized HTML generation without
    editor overhead</li>
    <li><strong>Flexibility</strong>: Custom handling for special
    components and embeds</li>
    </ol>
    <h2 id="architecture-decision">üèóÔ∏è Architecture Decision</h2>
    <h3 id="storage-configuration">Storage Configuration</h3>
    <div class="sourceCode" id="cb1"><pre
    class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// CRITICAL: Data isolation configuration</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>storageManager<span class="op">:</span> {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;none&quot;</span><span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
    <p>This configuration ensures:</p>
    <ul>
    <li>No local storage persistence</li>
    <li>No cross-presentation data leakage</li>
    <li>Complete control over save/load operations</li>
    </ul>
    <h3 id="rendering-flow">Rendering Flow</h3>
    <pre><code>Editor ‚Üí JSON Data ‚Üí Backend Publishing Service ‚Üí Static HTML</code></pre>
    <ol type="1">
    <li><strong>Editor</strong>: User creates presentation with
    GrapesJS</li>
    <li><strong>Save</strong>: Component tree saved as JSON to
    database</li>
    <li><strong>Publish</strong>: Backend converts JSON to optimized
    HTML</li>
    <li><strong>Serve</strong>: Static HTML served with no JavaScript
    dependencies</li>
    </ol>
    <h2 id="component-rendering-pipeline">üîß Component Rendering
    Pipeline</h2>
    <h3 id="core-rendercomponent-function">Core
    <code>renderComponent()</code> Function</h3>
    <p>Located in
    <code>/backend/src/services/publishingService.js</code>, this
    function:</p>
    <ol type="1">
    <li><strong>Handles Component Types</strong>
    <ul>
    <li>Text nodes</li>
    <li>SVG elements</li>
    <li>SDK plugin components</li>
    <li>Standard HTML elements</li>
    </ul></li>
    <li><strong>Attribute Processing</strong>
    <ul>
    <li>Preserves component IDs</li>
    <li>Maintains CSS classes</li>
    <li>Handles data attributes</li>
    <li>Processes inline styles</li>
    </ul></li>
    <li><strong>Special Handling</strong>
    <ul>
    <li>Smart tag detection for text elements</li>
    <li>Link processing (external vs internal)</li>
    <li>Embed code injection</li>
    <li>Interactive element preservation</li>
    </ul></li>
    </ol>
    <h3 id="component-detection-strategy">Component Detection
    Strategy</h3>
    <div class="sourceCode" id="cb3"><pre
    class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Multiple detection methods for robustness</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> isIconifyComponent <span class="op">=</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  component<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">&quot;iconify&quot;</span> <span class="op">||</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  component<span class="op">.</span><span class="at">attributes</span><span class="op">?.</span>[<span class="st">&quot;data-type-iconify&quot;</span>] <span class="op">!==</span> <span class="kw">undefined</span><span class="op">;</span></span></code></pre></div>
    <h2 id="sdk-component-support">üé® SDK Component Support</h2>
    <h3 id="fully-supported-sdk-components-v1.10.40">Fully Supported SDK
    Components (v1.10.40)</h3>
    <h4 id="iconify-components">1. <strong>Iconify
    Components</strong></h4>
    <ul>
    <li><strong>Detection</strong>: <code>data-type-iconify</code>
    attribute</li>
    <li><strong>Structure</strong>:
    <code>&lt;div&gt;&lt;svg&gt;...&lt;/svg&gt;&lt;/div&gt;</code></li>
    <li><strong>Fallback</strong>: Info icon when SVG missing</li>
    <li><strong>CSS</strong>: Proper sizing (1em x 1em)</li>
    </ul>
    <h4 id="accordion-components">2. <strong>Accordion
    Components</strong></h4>
    <ul>
    <li><strong>Detection</strong>:
    <code>data-type-role="accordion"</code></li>
    <li><strong>Structure</strong>:
    <code>&lt;details&gt;/&lt;summary&gt;</code> elements</li>
    <li><strong>Marker</strong>: Arrow SVG with rotation animation</li>
    <li><strong>Fallback</strong>: Default chevron arrow</li>
    </ul>
    <h4 id="list-pages-navigation">3. <strong>List Pages
    Navigation</strong></h4>
    <ul>
    <li><strong>Detection</strong>:
    <code>data-type-role="list-pages"</code></li>
    <li><strong>Structure</strong>:
    <code>&lt;ul&gt;/&lt;li&gt;/&lt;a&gt;</code> hierarchy</li>
    <li><strong>Functionality</strong>: Page navigation links</li>
    <li><strong>Issue</strong>: Doesn‚Äôt update dynamically (pending
    fix)</li>
    </ul>
    <h4 id="lightgallery">4. <strong>LightGallery</strong></h4>
    <ul>
    <li><strong>Detection</strong>: <code>data-lightgallery</code>
    attribute</li>
    <li><strong>Init</strong>: Dynamic script loading</li>
    <li><strong>Config</strong>: Full plugin suite with license</li>
    <li><strong>Status</strong>: Fully functional</li>
    </ul>
    <h4 id="fslightbox">5. <strong>FSLightbox</strong></h4>
    <ul>
    <li><strong>Detection</strong>: <code>data-fslightbox</code>
    attribute</li>
    <li><strong>Structure</strong>: <code>&lt;a&gt;</code> with lightbox
    attributes</li>
    <li><strong>Init</strong>: Automatic via data attributes</li>
    <li><strong>Status</strong>: Fully functional</li>
    </ul>
    <h4 id="animation-components">6. <strong>Animation
    Components</strong></h4>
    <ul>
    <li><strong>Detection</strong>:
    <code>data-type-role="animation"</code></li>
    <li><strong>Config</strong>: CSS variables for control</li>
    <li><strong>Features</strong>: Scroll-triggered animations</li>
    <li><strong>Status</strong>: Fully functional</li>
    </ul>
    <h4 id="flex-layout-components">7. <strong>Flex Layout
    Components</strong></h4>
    <ul>
    <li><strong>Detection</strong>:
    <code>data-type-role="flex-row/column"</code></li>
    <li><strong>Structure</strong>: Flexbox containers</li>
    <li><strong>CSS</strong>: Direction and alignment</li>
    <li><strong>Status</strong>: Fully functional</li>
    </ul>
    <h2 id="testing-checklist">üß™ Testing Checklist</h2>
    <h3 id="sdk-components-tested-working">SDK Components (‚úÖ Tested
    &amp; Working)</h3>
    <ul class="task-list">
    <li><label><input type="checkbox" checked="" />Iconify icons display
    correctly</label></li>
    <li><label><input type="checkbox" checked="" />Accordion
    expand/collapse works</label></li>
    <li><label><input type="checkbox" checked="" />Accordion arrows show
    to the right</label></li>
    <li><label><input type="checkbox" checked="" />LightGallery opens in
    lightbox</label></li>
    <li><label><input type="checkbox" checked="" />FSLightbox
    functionality</label></li>
    <li><label><input type="checkbox" checked="" />Animation triggers on
    scroll</label></li>
    <li><label><input type="checkbox" checked="" />Flex layouts render
    properly</label></li>
    <li><label><input type="checkbox" />List Pages updates
    dynamically</label></li>
    </ul>
    <h3 id="standard-components-need-testing">Standard Components (Need
    Testing)</h3>
    <ul class="task-list">
    <li><label><input type="checkbox" />Text components (h1-h6,
    p)</label></li>
    <li><label><input type="checkbox" />Images (standard &amp;
    responsive)</label></li>
    <li><label><input type="checkbox" />Links (internal &amp;
    external)</label></li>
    <li><label><input type="checkbox" />Buttons (all
    variations)</label></li>
    <li><label><input type="checkbox" />Forms and inputs</label></li>
    <li><label><input type="checkbox" />Tables</label></li>
    <li><label><input type="checkbox" />Videos</label></li>
    <li><label><input type="checkbox" />Maps</label></li>
    <li><label><input type="checkbox" />Custom embeds</label></li>
    <li><label><input type="checkbox" />Charts (bar, pie,
    line)</label></li>
    </ul>
    <h3 id="layout-components-need-testing">Layout Components (Need
    Testing)</h3>
    <ul class="task-list">
    <li><label><input type="checkbox" />Sections</label></li>
    <li><label><input type="checkbox" />Containers</label></li>
    <li><label><input type="checkbox" />Rows &amp; Columns</label></li>
    <li><label><input type="checkbox" />Grid layouts</label></li>
    <li><label><input type="checkbox" />Spacing &amp;
    padding</label></li>
    </ul>
    <h3 id="styling-need-testing">Styling (Need Testing)</h3>
    <ul class="task-list">
    <li><label><input type="checkbox" />Typography presets</label></li>
    <li><label><input type="checkbox" />Color variables</label></li>
    <li><label><input type="checkbox" />Custom CSS</label></li>
    <li><label><input type="checkbox" />Responsive behavior</label></li>
    <li><label><input type="checkbox" />Hover states</label></li>
    <li><label><input type="checkbox" />Animations</label></li>
    </ul>
    <h2 id="troubleshooting-guide">üîç Troubleshooting Guide</h2>
    <h3 id="component-not-rendering">Component Not Rendering</h3>
    <ol type="1">
    <li><p><strong>Check Detection</strong></p>
    <div class="sourceCode" id="cb4"><pre
    class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Component type:&quot;</span><span class="op">,</span> component<span class="op">.</span><span class="at">type</span>)<span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Attributes:&quot;</span><span class="op">,</span> component<span class="op">.</span><span class="at">attributes</span>)<span class="op">;</span></span></code></pre></div></li>
    <li><p><strong>Verify Structure</strong></p>
    <ul>
    <li>Is tagName set correctly?</li>
    <li>Are attributes preserved?</li>
    <li>Is content/children handled?</li>
    </ul></li>
    <li><p><strong>CSS Issues</strong></p>
    <ul>
    <li>Check generateGrapesJSPluginCSS()</li>
    <li>Verify selectors match attributes</li>
    <li>Use !important if needed</li>
    </ul></li>
    </ol>
    <h3 id="missing-content">Missing Content</h3>
    <ol type="1">
    <li><strong>SVG Components</strong>
    <ul>
    <li>Check if SVG stored as child or content</li>
    <li>Verify xmlns attribute</li>
    <li>Use fallback SVG if missing</li>
    </ul></li>
    <li><strong>Text Content</strong>
    <ul>
    <li>Check textnode handling</li>
    <li>Verify content vs components</li>
    <li>Handle HTML content properly</li>
    </ul></li>
    </ol>
    <h3 id="javascript-not-working">JavaScript Not Working</h3>
    <ol type="1">
    <li><strong>Initialization</strong>
    <ul>
    <li>Check generateComponentInitScripts()</li>
    <li>Verify script loading order</li>
    <li>Check for console errors</li>
    </ul></li>
    <li><strong>Dependencies</strong>
    <ul>
    <li>Ensure CDN scripts load</li>
    <li>Check version compatibility</li>
    <li>Verify license keys</li>
    </ul></li>
    </ol>
    <h2 id="version-history">üìä Version History</h2>
    <ul>
    <li><strong>v1.10.38</strong>: Initial SDK component fixes</li>
    <li><strong>v1.10.39</strong>: LightGallery and CSS
    enhancements</li>
    <li><strong>v1.10.40</strong>: SVG fallbacks for missing
    content</li>
    </ul>
    <h2 id="future-enhancements">üöÄ Future Enhancements</h2>
    <ol type="1">
    <li><strong>Dynamic Page Navigation</strong>: Real-time updates when
    pages change</li>
    <li><strong>Component Library</strong>: Comprehensive testing of all
    blocks</li>
    <li><strong>Performance</strong>: Optimize rendering for large
    presentations</li>
    <li><strong>Caching</strong>: Implement smart caching for published
    content</li>
    </ol>
    <h2 id="related-documentation">üîó Related Documentation</h2>
    <ul>
    <li><a href="/docs/03-reference/GrapesJS_SDK_Docs/">GrapesJS SDK
    Docs</a></li>
    <li><a href="/docs/02-development/PUBLISHING_SERVICE.md">Publishing
    Service Guide</a></li>
    <li><a href="/docs/03-reference/TESTING_PROCEDURES.md">Testing
    Procedures</a></li>
    </ul>
    
    <div class="footer">
        <p>InvestorPrez Documentation | <a href="https://investorprez.github.io/investorprez-docs/">Documentation Home</a></p>
    </div>
</body>
</html>
